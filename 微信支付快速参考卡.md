# å¾®ä¿¡æ”¯ä»˜æ–‡ä»¶å¿«é€Ÿå‚è€ƒå¡

## ğŸ¯ ä¸€é¡µçº¸æ€»ç»“

### æ ¸å¿ƒæ–‡ä»¶ä½ç½®
```
K:\365-android\ç»¼åˆæ”¶é“¶å°æ¥å£åŒ…_V4.0è½¯ä»¶åŒ…\demo\
```

### å¾®ä¿¡æ”¯ä»˜ç›¸å…³æ–‡ä»¶åˆ—è¡¨

| # | æ–‡ä»¶å | åŠŸèƒ½ | è°ƒç”¨ç±» | ç”¨é€” |
|---|--------|------|--------|------|
| 1 | **MerchantPaymentUnified.aspx** | ç»Ÿä¸€æ”¯ä»˜è¯·æ±‚ | `UnifiedPaymentRequest` | â­â­â­â­â­ **æœ€é‡è¦** |
| 2 | GetWeiXinAuthInfo.aspx | äººè„¸è®¤è¯ | `GetWeiXinAuthInfo` | â­â­â­ é«˜ä¼˜å…ˆçº§ |
| 3 | MerchantPayCancel.aspx | æ”¯ä»˜æ’¤é”€ | `MerchantPayCancel` | â­â­â­ é«˜ä¼˜å…ˆçº§ |
| 4 | MerchantRealTimeRegister.aspx | å®æ—¶ç»“ç®— | æ”¯ä»˜è¯·æ±‚ç±» | â­â­ ä¸­ä¼˜å…ˆçº§ |
| 5 | DownloadStatement.aspx | å¯¹è´¦å•ä¸‹è½½ | æŸ¥è¯¢ç±» | â­â­ ä¸­ä¼˜å…ˆçº§ |
| 6 | Merchant.html | èœå•å¯¼èˆª | - | â­ ä½ä¼˜å…ˆçº§ |

---

## ğŸ“‹ æ”¯ä»˜å‚æ•°é€ŸæŸ¥è¡¨

### å¾®ä¿¡æ”¯ä»˜ç±»å‹ä»£ç 
```
PaymentType = "8"  â† å¿…é¡»è®¾ç½®ä¸º 8 è¡¨ç¤ºå¾®ä¿¡æ”¯ä»˜
```

### æ”¯ä»˜æ–¹å¼ä»£ç 
```
TrnxCode:
  1 = POSæ”¯ä»˜
  2 = BMPæ”¯ä»˜
  3 = ç°é‡‘æ”¯ä»˜
  4 = å•†æˆ·è‡ªæœ‰æ”¯ä»˜
  5 = ç½‘é“¶è½¬è´¦
  6 = å…¶ä»–
  8 = å¾®ä¿¡æ”¯ä»˜ â­
  9 = æ”¯ä»˜å®æ”¯ä»˜
```

### æ”¯ä»˜äº¤æ˜“ç±»å‹ (PayTypeID)
```
- å…¬ä¼—å·æ”¯ä»˜
- å°ç¨‹åºæ”¯ä»˜
- APPæ”¯ä»˜
- åˆ·å¡æ”¯ä»˜
```

### å¿…å¡«å‚æ•°
```json
{
  "PaymentType": "8",           // å¾®ä¿¡æ”¯ä»˜
  "OrderNo": "è®¢å•å·",
  "OrderAmount": "é‡‘é¢",
  "OrderDate": "YYYY/MM/DD",
  "OrderTime": "HH:MM:SS"
}
```

### æ¡ä»¶å¿…å¡«å‚æ•°
```json
{
  "PayTypeID": "å…¬ä¼—å·æ”¯ä»˜|å°ç¨‹åºæ”¯ä»˜|APPæ”¯ä»˜|åˆ·å¡æ”¯ä»˜",
  "AccountNo": "AppID (å…¬ä¼—å·/å°ç¨‹åº) æˆ– auth_code (åˆ·å¡)",
  "OpenID": "ç”¨æˆ·OpenID (å…¬ä¼—å·/å°ç¨‹åºå¿…å¡«)"
}
```

---

## ğŸ”„ æ”¯ä»˜æµç¨‹

```
1ï¸âƒ£ è·å–è®¤è¯ä¿¡æ¯
   GetWeiXinAuthInfo â†’ è¿”å› AuthInfo

2ï¸âƒ£ å‘èµ·æ”¯ä»˜è¯·æ±‚
   MerchantPaymentUnified â†’ è¿”å›æ”¯ä»˜ä¿¡æ¯æˆ–é“¾æ¥

3ï¸âƒ£ ç”¨æˆ·æ”¯ä»˜

4ï¸âƒ£ æ¥æ”¶å›è°ƒé€šçŸ¥

5ï¸âƒ£ å¦‚éœ€æ’¤é”€/é€€æ¬¾
   MerchantPayCancel â†’ å¤„ç†é€€æ¬¾
```

---

## ğŸ’» ä»£ç ç‰‡æ®µ

### æœ€å°åŒ–æ”¯ä»˜è¯·æ±‚
```csharp
var request = new UnifiedPaymentRequest();
request.dicOrder["PaymentType"] = "8";          // å¾®ä¿¡æ”¯ä»˜
request.dicOrder["OrderNo"] = "20260107001";
request.dicOrder["OrderAmount"] = "100.00";
request.dicOrder["PayTypeID"] = "å°ç¨‹åºæ”¯ä»˜";
request.dicOrder["AccountNo"] = "wxAppID";      // å­å•†æˆ·APPID
request.dicOrder["OpenID"] = "userOpenID";      // ç”¨æˆ·OpenID
request.dicOrder["OrderDate"] = "2026/01/07";
request.dicOrder["OrderTime"] = "12:00:00";
request.postRequest();
```

### å¾®ä¿¡äººè„¸è®¤è¯
```csharp
var authInfo = new GetWeiXinAuthInfo();
authInfo.merchantInfoRequest["StoreId"] = "12345";
authInfo.merchantInfoRequest["SubAppId"] = "wxAppID";
authInfo.postJSONRequest();
```

### æ”¯ä»˜æ’¤é”€
```csharp
var cancel = new MerchantPayCancel();
cancel.dicRequest["OrigOrderNo"] = "20260107001";
cancel.dicRequest["MerchantFlag"] = "W";  // W=å¾®ä¿¡ Z=æ”¯ä»˜å®
cancel.postRequest();
```

---

## ğŸ”‘ å…³é”®å­—æ®µæ˜ å°„

| å†œè¡Œå­—æ®µ | å¾®ä¿¡å­—æ®µ | è¯´æ˜ |
|---------|---------|------|
| AccountNo | sub_appid | å°ç¨‹åºAPPID |
| OpenID | sub_openid | ç”¨æˆ·OpenID |
| OrderNo | out_trade_no | å¤–éƒ¨è®¢å•å· |
| OrderAmount | total_fee | æ€»é‡‘é¢ |
| OrderDesc | body | å•†å“æè¿° |

---

## â“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åŒºåˆ†å¾®ä¿¡å’Œæ”¯ä»˜å®æ”¯ä»˜ï¼Ÿ
**A:**
```
PaymentType = "8"   â†’ å¾®ä¿¡æ”¯ä»˜
PaymentType = "A"   â†’ æ”¯ä»˜å®æ”¯ä»˜
MerchantFlag = "W"  â†’ å¾®ä¿¡ï¼ˆç”¨äºæ’¤é”€ï¼‰
MerchantFlag = "Z"  â†’ æ”¯ä»˜å®ï¼ˆç”¨äºæ’¤é”€ï¼‰
```

### Q: å…¬ä¼—å·/å°ç¨‹åº/APPæ”¯ä»˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
**A:**
- **å…¬ä¼—å·æ”¯ä»˜**ï¼šåœ¨å¾®ä¿¡å…¬ä¼—å·å†…è°ƒç”¨ï¼Œéœ€è¦ OpenID
- **å°ç¨‹åºæ”¯ä»˜**ï¼šåœ¨å¾®ä¿¡å°ç¨‹åºå†…è°ƒç”¨ï¼Œéœ€è¦ OpenID
- **APPæ”¯ä»˜**ï¼šç¬¬ä¸‰æ–¹åº”ç”¨ä¸­è°ƒç”¨ï¼Œå¯èƒ½éœ€è¦æˆæƒç 
- **åˆ·å¡æ”¯ä»˜**ï¼šPOSæœºæ‰«æï¼Œéœ€è¦ auth_code

### Q: å“ªä¸ªå‚æ•°å¯¹åº”å¾®ä¿¡ç»Ÿä¸€ä¸‹å•æ¥å£çš„ sub_appidï¼Ÿ
**A:** `AccountNo` å­—æ®µå¯¹åº”å¾®ä¿¡çš„ `sub_appid`

### Q: éœ€è¦å¤„ç†å¼‚æ­¥å›è°ƒå—ï¼Ÿ
**A:** æ˜¯çš„ï¼Œå†œè¡Œä¼šåœ¨æ”¯ä»˜å®Œæˆåå¼‚æ­¥é€šçŸ¥ï¼Œéœ€è¦å®ç°å›è°ƒå¤„ç†æ¥å£

---

## ğŸ“ å…³é”®ä¿¡æ¯

**æ¥å£åŒ…ä½ç½®**ï¼š
```
K:\365-android\ç»¼åˆæ”¶é“¶å°æ¥å£åŒ…_V4.0è½¯ä»¶åŒ…
```

**å®˜æ–¹æ–‡æ¡£**ï¼š
```
https://bank.u51.com/ebus-two/docs/#/
```

**å…³é”®æ–‡ä»¶**ï¼š
```
MerchantPaymentUnified.aspx    (æœ€é‡è¦ï¼â­â­â­â­â­)
GetWeiXinAuthInfo.aspx          (äººè„¸è®¤è¯)
MerchantPayCancel.aspx          (é€€æ¬¾æ’¤é”€)
```

---

**å¿«é€Ÿå‚è€ƒå¡ç‰ˆæœ¬**ï¼šv1.0  
**æ›´æ–°æ—¶é—´**ï¼š2026-01-07  
**ç”¨é€”**ï¼šå¾®ä¿¡æ”¯ä»˜é›†æˆå¿«é€ŸæŸ¥è¯¢
