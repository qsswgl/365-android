# ğŸ“± æ‰«ç åŠŸèƒ½æµ‹è¯•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—ç”¨äºæµ‹è¯•å’ŒéªŒè¯ 365 å†œè¡Œåº”ç”¨çš„æ¡ç æ‰«æåŠŸèƒ½ã€‚åº”ç”¨å·²è¿›è¡Œäº†å¤§å¹…å¢å¼ºï¼ŒåŒ…æ‹¬ï¼š
- âœ… å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… æƒé™æ£€æŸ¥å’Œè¯·æ±‚
- âœ… JavaScript æ¡¥æ¥æ”¹è¿›
- âœ… å®æ—¶è¯Šæ–­åŠŸèƒ½

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ ç¼–è¯‘å’Œå®‰è£…

```bash
cd K:\365-android

# ç¼–è¯‘ Debug APK
.\gradlew.bat assembleDebug

# å®‰è£…åˆ°è®¾å¤‡ï¼ˆè¯·ç¡®ä¿è¿æ¥å·²å»ºç«‹ï¼‰
.\adb install -r app\build\outputs\apk\debug\app-debug.apk

# å¯åŠ¨åº”ç”¨
.\adb shell am start -n net.qsgl365/.MainActivity
```

### 2ï¸âƒ£ å¯åŠ¨ logcat ç›‘å¬

**åœ¨ä¸€ä¸ªæ–°çš„ PowerShell çª—å£ä¸­è¿è¡Œ**ï¼š

```bash
cd K:\365-android
.\adb logcat
```

è¿™å°†æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—è¾“å‡ºã€‚å…³é”®çš„æ‰«ç æ—¥å¿—å°†åŒ…å«ï¼š
- `BarcodeScannerActivity`ï¼šæ‰«ç  Activity çš„æ—¥å¿—
- `REQUEST`ï¼šæƒé™è¯·æ±‚ç›¸å…³æ—¥å¿—
- `æƒé™`ï¼ˆä¸­æ–‡ï¼‰ï¼šæƒé™æ£€æŸ¥ç›¸å…³æ—¥å¿—

---

## ğŸ§ª æµ‹è¯•æµç¨‹

### æµ‹è¯• 1: è®¿é—®æ‰«ç æµ‹è¯•é¡µé¢

**æ­¥éª¤**ï¼š
1. åº”ç”¨å¯åŠ¨åï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
   ```
   http://192.168.1.129:8080/pwa/barcode-test-simple.html
   ```

2. æˆ–è€…åœ¨åº”ç”¨ä¸­å¯¼èˆªåˆ°æ‰«ç æµ‹è¯•è·¯ç”±

3. åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å…ƒç´ ï¼š
   - âœ… "æ‰«ç åŠŸèƒ½æµ‹è¯• - ç®€åŒ–ç‰ˆ" æ ‡é¢˜
   - âœ… "å¯åŠ¨æ‰«ç " è“è‰²æŒ‰é’®
   - âœ… æ—¥å¿—è¾“å‡ºåŒºåŸŸï¼ˆé»‘è‰²èƒŒæ™¯ï¼‰

### æµ‹è¯• 2: æƒé™è¯·æ±‚æµç¨‹

**æ­¥éª¤**ï¼š
1. ç‚¹å‡» "å¯åŠ¨æ‰«ç " æŒ‰é’®
2. **é¢„æœŸè¡Œä¸º**ï¼š
   - åº”è¯¥çœ‹åˆ° Android æƒé™è¯·æ±‚å¯¹è¯æ¡†
   - å¯¹è¯æ¡†åº”è¯·æ±‚"æ‘„åƒå¤´"æƒé™
3. **æ£€æŸ¥ logcat**ï¼š
   ```
   D BarcodeScannerActivity: æ£€æŸ¥æ‘„åƒå¤´æƒé™
   D BarcodeScannerActivity: æ‘„åƒå¤´æƒé™æœªæˆäºˆï¼Œè¯·æ±‚æƒé™
   ```

### æµ‹è¯• 3: æˆäºˆæƒé™

**æ­¥éª¤**ï¼š
1. åœ¨æƒé™å¯¹è¯æ¡†ä¸­ç‚¹å‡» "å…è®¸"
2. **é¢„æœŸè¡Œä¸º**ï¼š
   - æ‘„åƒå¤´åº”è¯¥å¯åŠ¨
   - åº”è¯¥çœ‹åˆ°å®æ—¶æ‘„åƒå¤´é¢„è§ˆ
   - HTML æµ‹è¯•é¡µé¢çš„æ—¥å¿—åŒºåŸŸåº”æ˜¾ç¤ºç›¸å…³ä¿¡æ¯

**æ£€æŸ¥ logcat**ï¼š
```
D BarcodeScannerActivity: æƒé™è¯·æ±‚ç»“æœå›è°ƒ: requestCode=100
D BarcodeScannerActivity: âœ… æ‘„åƒå¤´æƒé™å·²æˆäºˆ
D BarcodeScannerActivity: å¯åŠ¨æ‘„åƒå¤´
D BarcodeScannerActivity: æ‘„åƒå¤´æä¾›ç¨‹åºå·²ç»‘å®š
```

### æµ‹è¯• 4: æ‰«ææ¡ç 

**æ­¥éª¤**ï¼š
1. æ‘„åƒå¤´å·²å¯åŠ¨åï¼Œå°†æ¡ç æˆ–äºŒç»´ç æ”¾åœ¨æ‘„åƒå¤´å‰é¢
2. **é¢„æœŸè¡Œä¸º**ï¼š
   - æ¡ç åº”è¯¥è¢«æ£€æµ‹
   - HTML æµ‹è¯•é¡µé¢åº”æ˜¾ç¤ºæ‰«æç»“æœ
   - æ˜¾ç¤ºçš„ä¿¡æ¯åº”åŒ…æ‹¬ï¼š
     - æ¡ç æ ¼å¼ï¼ˆå¦‚ QR_CODE, CODE_128 ç­‰ï¼‰
     - æ¡ç å€¼ï¼ˆæ‰«æçš„æ•°æ®ï¼‰
     - æ—¶é—´æˆ³

**æ£€æŸ¥ logcat**ï¼š
```
D BarcodeScannerActivity: æ¡ç æ‰«ææ£€æµ‹åˆ°: æ¡ç å¯¹è±¡
D MainActivity: startBarcodeScanning() è°ƒç”¨æˆåŠŸ
D MainActivity: è°ƒç”¨ invokeBarcodeScannedCallback...
D MainActivity: æˆåŠŸè°ƒç”¨ JavaScript å›è°ƒ
```

### æµ‹è¯• 5: æ‹’ç»æƒé™

**æ­¥éª¤**ï¼š
1. å†æ¬¡ç‚¹å‡» "å¯åŠ¨æ‰«ç " æŒ‰é’®
2. åœ¨æƒé™å¯¹è¯æ¡†ä¸­ç‚¹å‡» "æ‹’ç»"
3. **é¢„æœŸè¡Œä¸º**ï¼š
   - åº”è¯¥çœ‹åˆ° Toast æç¤ºï¼š"éœ€è¦æ‘„åƒå¤´æƒé™æ‰èƒ½æ‰«æäºŒç»´ç "
   - HTML æµ‹è¯•é¡µé¢åº”æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
   - Activity åº”è¯¥å…³é—­å¹¶è¿”å›ä¸»é¡µé¢

**æ£€æŸ¥ logcat**ï¼š
```
D BarcodeScannerActivity: æƒé™è¯·æ±‚ç»“æœå›è°ƒ: requestCode=100
D BarcodeScannerActivity: âŒ æ‘„åƒå¤´æƒé™è¢«æ‹’ç»
D BarcodeScannerActivity: è®¾ç½®è¿”å›ç»“æœä¸º RESULT_CANCELED
```

---

## ğŸ” è¯¦ç»†æ—¥å¿—åˆ†æ

### å…³é”®æ—¥å¿—ç‚¹

| æ—¥å¿—å†…å®¹ | å«ä¹‰ | é¢„æœŸçŠ¶æ€ |
|---------|------|--------|
| `å¼€å§‹åˆå§‹åŒ–æ‰«ç  Activity` | Activity åˆ›å»º | âœ… æ­£å¸¸ |
| `æ¡ç æ‰«æå™¨åˆå§‹åŒ–æˆåŠŸ` | ML Kit æ‰«æå™¨åˆå§‹åŒ– | âœ… æ­£å¸¸ |
| `æ£€æŸ¥æ‘„åƒå¤´æƒé™` | å¼€å§‹æ£€æŸ¥æƒé™ | âœ… æ­£å¸¸ |
| `æ‘„åƒå¤´æƒé™å·²æˆäºˆï¼Œå¯åŠ¨æ‘„åƒå¤´` | æƒé™å·²å­˜åœ¨ | âœ… æ­£å¸¸ |
| `æ‘„åƒå¤´æƒé™æœªæˆäºˆï¼Œè¯·æ±‚æƒé™` | éœ€è¦è¯·æ±‚æƒé™ | âœ… æ­£å¸¸ |
| `æƒé™è¯·æ±‚ç»“æœå›è°ƒ: requestCode=100` | æƒé™å›è°ƒ | âœ… æ­£å¸¸ |
| `âœ… æ‘„åƒå¤´æƒé™å·²æˆäºˆ` | æƒé™å·²è·æ‰¹ | âœ… æ­£å¸¸ |
| `âŒ æ‘„åƒå¤´æƒé™è¢«æ‹’ç»` | æƒé™è¢«æ‹’ç» | âš ï¸ éœ€è¦ç”¨æˆ·å¤„ç† |
| `å¯åŠ¨æ‘„åƒå¤´` | æ‘„åƒå¤´åˆå§‹åŒ– | âœ… æ­£å¸¸ |
| `æ‘„åƒå¤´æä¾›ç¨‹åºå·²ç»‘å®š` | æ‘„åƒå¤´å°±ç»ª | âœ… æ­£å¸¸ |
| `æ¡ç æ‰«ææ£€æµ‹åˆ°: æ¡ç å¯¹è±¡` | æ‰«ææˆåŠŸ | âœ… æ­£å¸¸ |

### å®Œæ•´æ—¥å¿—æµç¨‹ç¤ºä¾‹

**æˆåŠŸæ‰«ææµç¨‹**ï¼š
```
D BarcodeScannerActivity: å¼€å§‹åˆå§‹åŒ–æ‰«ç  Activity
D BarcodeScannerActivity: æ¡ç æ‰«æå™¨åˆå§‹åŒ–æˆåŠŸ
D BarcodeScannerActivity: æ£€æŸ¥æ‘„åƒå¤´æƒé™
D BarcodeScannerActivity: æ‘„åƒå¤´æƒé™æœªæˆäºˆï¼Œè¯·æ±‚æƒé™
D BarcodeScannerActivity: æƒé™è¯·æ±‚ç»“æœå›è°ƒ: requestCode=100
D BarcodeScannerActivity: âœ… æ‘„åƒå¤´æƒé™å·²æˆäºˆ
D BarcodeScannerActivity: å¯åŠ¨æ‘„åƒå¤´
D BarcodeScannerActivity: æ‘„åƒå¤´æä¾›ç¨‹åºå·²ç»‘å®š
D BarcodeScannerActivity: æ¡ç æ‰«ææ£€æµ‹åˆ°: æ¡ç å¯¹è±¡
D MainActivity: startBarcodeScanning() è°ƒç”¨æˆåŠŸ
D MainActivity: è°ƒç”¨ invokeBarcodeScannedCallback...
D MainActivity: æˆåŠŸè°ƒç”¨ JavaScript å›è°ƒ
D WebViewConsole: [JavaScript] âœ… æ‰«ç æˆåŠŸ: QR_CODE
```

**æƒé™æ‹’ç»æµç¨‹**ï¼š
```
D BarcodeScannerActivity: å¼€å§‹åˆå§‹åŒ–æ‰«ç  Activity
D BarcodeScannerActivity: æ¡ç æ‰«æå™¨åˆå§‹åŒ–æˆåŠŸ
D BarcodeScannerActivity: æ£€æŸ¥æ‘„åƒå¤´æƒé™
D BarcodeScannerActivity: æ‘„åƒå¤´æƒé™æœªæˆäºˆï¼Œè¯·æ±‚æƒé™
D BarcodeScannerActivity: æƒé™è¯·æ±‚ç»“æœå›è°ƒ: requestCode=100
D BarcodeScannerActivity: âŒ æ‘„åƒå¤´æƒé™è¢«æ‹’ç»
D BarcodeScannerActivity: è®¾ç½®è¿”å›ç»“æœä¸º RESULT_CANCELED
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: çœ‹ä¸åˆ°æƒé™è¯·æ±‚å¯¹è¯æ¡†

**ç—‡çŠ¶**ï¼š
- ç‚¹å‡» "å¯åŠ¨æ‰«ç " åæ²¡æœ‰æƒé™å¯¹è¯æ¡†å‡ºç°

**å¯èƒ½åŸå› **ï¼š
1. æƒé™å·²ç»åœ¨ç³»ç»Ÿè®¾ç½®ä¸­è¢«æ°¸ä¹…æ‹’ç»
2. åº”ç”¨éœ€è¦é‡æ–°å¯åŠ¨
3. Android ç‰ˆæœ¬å·®å¼‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥æƒé™çŠ¶æ€
.\adb shell pm list permissions -d | grep CAMERA

# æ‰‹åŠ¨æˆäºˆæƒé™
.\adb shell pm grant net.qsgl365 android.permission.CAMERA

# æ¸…é™¤åº”ç”¨æ•°æ®å¹¶é‡å¯
.\adb shell pm clear net.qsgl365
.\adb shell am start -n net.qsgl365/.MainActivity
```

### é—®é¢˜ 2: æƒé™æˆäºˆä½†æ‘„åƒå¤´ä¸å¯åŠ¨

**ç—‡çŠ¶**ï¼š
- æ—¥å¿—æ˜¾ç¤º "âœ… æ‘„åƒå¤´æƒé™å·²æˆäºˆ" ä½†æ²¡æœ‰æ‘„åƒå¤´é¢„è§ˆ

**å¯èƒ½åŸå› **ï¼š
1. è®¾å¤‡æ‘„åƒå¤´ç¡¬ä»¶é—®é¢˜
2. æ‘„åƒå¤´å·²è¢«å…¶ä»–åº”ç”¨å ç”¨
3. æƒé™ç¼“å­˜é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸
.\adb logcat | findstr "æ‘„åƒå¤´|Camera|ProcessCameraProvider"

# æ€æ­»å…¶ä»–ä½¿ç”¨æ‘„åƒå¤´çš„è¿›ç¨‹
.\adb shell ps | grep camera

# é‡å¯åº”ç”¨
.\adb shell am force-stop net.qsgl365
.\adb shell am start -n net.qsgl365/.MainActivity
```

### é—®é¢˜ 3: æ‰«æç»“æœä¸º "ERROR" æˆ– "CANCELLED"

**ç—‡çŠ¶**ï¼š
- HTML æµ‹è¯•é¡µé¢æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
- logcat ä¸­æ²¡æœ‰æ¡ç æ£€æµ‹æ—¥å¿—

**å¯èƒ½åŸå› **ï¼š
1. æƒé™è¢«æ‹’ç»ï¼ˆæœ€å¸¸è§ï¼‰
2. æ‘„åƒå¤´æƒé™ç¼“å­˜é—®é¢˜
3. æ¡ç è´¨é‡ä¸è‰¯

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹ logcat ç¡®è®¤æƒé™çŠ¶æ€ï¼š
   ```bash
   .\adb logcat | findstr "æƒé™|PERMISSION"
   ```

2. å¦‚æœæ˜¾ç¤º "âŒ æ‘„åƒå¤´æƒé™è¢«æ‹’ç»"ï¼š
   - åœ¨è®¾ç½®ä¸­æ‰‹åŠ¨æˆäºˆæƒé™
   - æˆ–ä½¿ç”¨å‘½ä»¤è¡Œæˆäºˆï¼š`.\adb shell pm grant net.qsgl365 android.permission.CAMERA`

3. å¦‚æœæƒé™å·²æˆäºˆä½†ä»æ˜¾ç¤ºé”™è¯¯ï¼š
   - å°è¯•ç”¨æ¸…æ™°çš„äºŒç»´ç æˆ–æ¡ç 
   - ç¡®ä¿æ‘„åƒå¤´æœ‰è¶³å¤Ÿçš„å…‰çº¿
   - æŸ¥çœ‹æ‘„åƒå¤´æ˜¯å¦å¯åŠ¨æˆåŠŸ

### é—®é¢˜ 4: ç¼–è¯‘å¤±è´¥

**ç—‡çŠ¶**ï¼š
- `.\gradlew.bat assembleDebug` å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. Java ä»£ç è¯­æ³•é”™è¯¯
2. ä¾èµ–ç‰ˆæœ¬ä¸å…¼å®¹
3. Android SDK ç‰ˆæœ¬é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…é™¤æ„å»ºç¼“å­˜
.\gradlew.bat clean

# é‡æ–°ç¼–è¯‘ï¼ˆæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ï¼‰
.\gradlew.bat assembleDebug --stacktrace

# æ£€æŸ¥ç‰¹å®šé”™è¯¯
.\gradlew.bat assembleDebug 2>&1 | findstr "error"
```

---

## ğŸ“Š æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] åº”ç”¨æˆåŠŸç¼–è¯‘ï¼ˆ0 errorsï¼‰
- [ ] APK æˆåŠŸå®‰è£…åˆ°è®¾å¤‡
- [ ] åº”ç”¨æˆåŠŸå¯åŠ¨
- [ ] èƒ½è®¿é—®æ‰«ç æµ‹è¯•é¡µé¢
- [ ] ç‚¹å‡» "å¯åŠ¨æ‰«ç " åå‡ºç°æƒé™å¯¹è¯æ¡†
- [ ] æˆäºˆæƒé™åçœ‹åˆ°æ‘„åƒå¤´é¢„è§ˆ
- [ ] èƒ½æ‰«æäºŒç»´ç /æ¡ç 
- [ ] HTML é¡µé¢æ˜¾ç¤ºæ­£ç¡®çš„æ‰«æç»“æœ
- [ ] logcat æ˜¾ç¤ºæ‰€æœ‰é¢„æœŸçš„æ—¥å¿—
- [ ] æƒé™æ‹’ç»æ—¶æ˜¾ç¤ºæ­£ç¡®çš„é”™è¯¯æç¤º

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| `app/src/main/java/net/qsgl365/MainActivity.java` | ä¸» Activityï¼Œå¤„ç† JavaScript æ¡¥æ¥å’Œå›è°ƒ |
| `app/src/main/java/net/qsgl365/BarcodeScannerActivity.java` | æ‰«ç  Activityï¼Œå¤„ç†æ‘„åƒå¤´å’Œ ML Kit |
| `app/assets/pwa/barcode-test-simple.html` | æ‰«ç åŠŸèƒ½æµ‹è¯•é¡µé¢ï¼ˆç®€åŒ–ç‰ˆï¼‰ |
| `app/assets/pwa/barcode-scanner-test.html` | æ‰«ç åŠŸèƒ½æµ‹è¯•é¡µé¢ï¼ˆå®Œæ•´ç‰ˆï¼‰ |

---

## ğŸ”— æ›´å¤šèµ„æº

- **ML Kit Barcode Scanning**ï¼šhttps://developers.google.com/ml-kit/vision/barcode-scanning
- **Android Camera X**ï¼šhttps://developer.android.com/training/camerax
- **Android Permissions**ï¼šhttps://developer.android.com/training/permissions

---

## âœ… æµ‹è¯•å®Œæˆ

å½“æ‰€æœ‰æ£€æŸ¥æ¸…å•ä¸­çš„é¡¹ç›®éƒ½æ ‡è®°ä¸º âœ… æ—¶ï¼Œæ‰«ç åŠŸèƒ½å·²éªŒè¯ä¸ºæ­£å¸¸å·¥ä½œã€‚

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒ"æ•…éšœæ’æŸ¥"éƒ¨åˆ†æˆ–æ£€æŸ¥ç›¸åº”çš„æ—¥å¿—è¾“å‡ºã€‚
