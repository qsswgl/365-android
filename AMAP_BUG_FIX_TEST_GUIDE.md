# é«˜å¾·åœ°å›¾å¯¼èˆªä¿®å¤ - å¿«é€Ÿæµ‹è¯•æŒ‡å—

## ä¿®å¤æ¦‚è§ˆ

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| **é—®é¢˜1**<br>Amapæœªç»‘å®šç›®çš„åœ° | URI Schemeæ ¼å¼ä¸æ­£ç¡® | æ­£ç¡®æ ¼å¼åŒ–åæ ‡å‚æ•°ï¼š`amap://navi?start=X,Y&destination=Z,W` |
| **é—®é¢˜2**<br>è¿”å›åç™½å± | ç¼ºå°‘Activityç”Ÿå‘½å‘¨æœŸç®¡ç† | æ·»åŠ onResume()é‡æ–°æ³¨å…¥Bridgeæ¢å¤WebViewçŠ¶æ€ |

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šéªŒè¯è‡ªåŠ¨ç»‘å®šç›®çš„åœ°

**æ­¥éª¤ï¼š**
```
1. æ‰“å¼€365APP â†’ ç­‰å¾…å®Œå…¨åŠ è½½
2. æ‰¾åˆ°å¯¼èˆªåŠŸèƒ½ â†’ ç‚¹å‡»å¼€å§‹å¯¼èˆª
3. é«˜å¾·åœ°å›¾å¯åŠ¨ â†’ è§‚å¯Ÿå¯¼èˆªç•Œé¢
4. é¢„æœŸï¼šèµ·ç‚¹å’Œç›®çš„åœ°åº”è‡ªåŠ¨å¡«å……ï¼Œæ˜¾ç¤ºè·¯çº¿
```

**æˆåŠŸæ ‡å¿—ï¼š**
```
âœ“ Amapæ˜¾ç¤ºå·²æœ‰åæ ‡çš„å¯¼èˆªç•Œé¢
âœ“ ç›®æ ‡ä½ç½®åœ¨åœ°å›¾ä¸Šå¯è§
âœ“ å¯¼èˆªè·¯çº¿å·²è®¡ç®—æ˜¾ç¤º
âœ“ æ— éœ€æ‰‹åŠ¨è¾“å…¥åæ ‡
```

**å¤±è´¥æ ‡å¿—ï¼š**
```
âœ— Amapæ‰“å¼€ä½†æ— ä»»ä½•åæ ‡æ˜¾ç¤º
âœ— éœ€è¦æ‰‹åŠ¨è¾“å…¥ç›®çš„åœ°
âœ— å¯¼èˆªæ— æ³•è‡ªåŠ¨åˆå§‹åŒ–
```

---

### åœºæ™¯2ï¼šéªŒè¯è¿”å›ä¸ç™½å±

**æ­¥éª¤ï¼š**
```
1. æŒ‰ä¸Šè¿°æ­¥éª¤æ‰“å¼€Amapè¿›è¡Œå¯¼èˆª
2. åœ¨Amapä¸­è¿›è¡Œæ“ä½œï¼ˆæŸ¥çœ‹è·¯çº¿ã€åˆ‡æ¢å¯¼èˆªæ¨¡å¼ç­‰ï¼‰
3. ç‚¹å‡»è¿”å›é”® â†’ è¿”å›365APP
4. è§‚å¯ŸAppç•Œé¢
```

**æˆåŠŸæ ‡å¿—ï¼š**
```
âœ“ Appæ­£å¸¸æ˜¾ç¤ºå†…å®¹ï¼ˆéç™½å±ï¼‰
âœ“ é¡µé¢å¯æ­£å¸¸æ»šåŠ¨å’Œäº¤äº’
âœ“ å¯¼èˆªèœå•ä»å¯ä½¿ç”¨
âœ“ ç”¨æˆ·ä¹‹å‰çš„æ“ä½œçŠ¶æ€ä¿ç•™
```

**å¤±è´¥æ ‡å¿—ï¼š**
```
âœ— Appç•Œé¢æ˜¾ç¤ºç™½å±
âœ— æ— æ³•ä¸é¡µé¢äº¤äº’
âœ— éœ€è¦é‡å¯Appæ‰èƒ½ç»§ç»­ä½¿ç”¨
```

---

## ğŸ“Š æ—¥å¿—éªŒè¯

### å®æ—¶æŸ¥çœ‹æ—¥å¿—

```powershell
# æ¸…ç©ºæ—§æ—¥å¿—
adb -s 192.168.1.75:37547 logcat -c

# ç›‘å¬æ–°æ—¥å¿—
adb -s 192.168.1.75:37547 logcat | findstr "WebView"
```

### å…³é”®æ—¥å¿—æ£€æŸ¥æ¸…å•

#### é—®é¢˜1ä¿®å¤éªŒè¯

æŸ¥æ‰¾è¿™äº›æ—¥å¿—ï¼š
```
âœ“ "å¤„ç†Amapå¯¼èˆªè¯·æ±‚"
âœ“ "ä½¿ç”¨åæ ‡æ„å»ºAmap Scheme"
âœ“ "å·²å¯åŠ¨åº”ç”¨: com.autonavi.minimap"
```

è¿™äº›æ—¥å¿—è¡¨ç¤ºï¼š
- å¯¼èˆªè¯·æ±‚è¢«æ­£ç¡®è¯†åˆ«
- åæ ‡å‚æ•°è¢«æ­£ç¡®æå–
- URI Schemeè¢«æ­£ç¡®æ„å»º

#### é—®é¢˜2ä¿®å¤éªŒè¯

è¿”å›åæŸ¥æ‰¾è¿™äº›æ—¥å¿—ï¼š
```
âœ“ "Activity onResume è¢«è°ƒç”¨"
âœ“ "å·²é‡æ–°æ³¨å…¥JavaScript Bridge"
âœ“ "å·²æ‰§è¡Œé¡µé¢æ¢å¤è„šæœ¬"
âœ“ "Activityå·²ä»åå°æ¢å¤"
```

è¿™äº›æ—¥å¿—è¡¨ç¤ºï¼š
- Activityæ­£ç¡®å¤„ç†åå°æ¢å¤
- JavaScript Bridgeæ­£ç¡®é‡æ–°æ³¨å…¥
- WebViewçŠ¶æ€è¢«æ­£ç¡®æ¢å¤

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ï¼šAmapä»æœªç»‘å®šåæ ‡

**å¯èƒ½åŸå› ï¼š**

1. **åæ ‡æå–å¤±è´¥**
   ```
   æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰ï¼š"æ— æ³•æå–åæ ‡"
   ```
   è§£å†³ï¼šç¡®ä¿URLåŒ…å«æ­£ç¡®çš„å‚æ•°åï¼ˆstartLat, startLng, endLat, endLngï¼‰

2. **Amapåº”ç”¨ç‰ˆæœ¬è¿‡æ—§**
   ```
   å°è¯•ï¼šæ›´æ–°é«˜å¾·åœ°å›¾åˆ°æœ€æ–°ç‰ˆæœ¬
   ```

3. **æ‰‹æœºç³»ç»Ÿé™åˆ¶**
   ```
   æ£€æŸ¥ï¼šè®¾ç½® â†’ åº”ç”¨æƒé™ â†’ é«˜å¾·åœ°å›¾
   ç¡®ä¿å·²æˆäºˆå¿…è¦æƒé™
   ```

### é—®é¢˜ï¼šè¿”å›åä»æ˜¾ç¤ºç™½å±

**å¯èƒ½åŸå› ï¼š**

1. **WebViewçŠ¶æ€æœªæ¢å¤**
   ```
   æ£€æŸ¥æ—¥å¿—ï¼šæ˜¯å¦æœ‰"JavaScript Bridge"æ³¨å…¥æ—¥å¿—
   å¦‚æ— ï¼Œè¯´æ˜onResume()æœªè¢«è§¦å‘
   ```

2. **é¡µé¢åŠ è½½è¶…æ—¶**
   ```
   è§£å†³ï¼šå¢åŠ é¡µé¢åŠ è½½è¶…æ—¶æ—¶é—´
   æˆ–è€…å¼ºåˆ¶é‡æ–°åŠ è½½ï¼šwebView.reload()
   ```

3. **JavaScriptä¸Šä¸‹æ–‡ä¸¢å¤±**
   ```
   æ·»åŠ é¡µé¢æ¢å¤å¤„ç†å™¨ï¼š
   window.pageResumeHandler = function() {
       // æ¢å¤é¡µé¢çŠ¶æ€
   }
   ```

---

## ğŸ“ ä¿®æ”¹ä»£ç æ¦‚è§ˆ

### ä¿®æ”¹1ï¼šAmap URI Schemeæ ¼å¼åŒ–

```java
// ä½ç½®ï¼šMainActivity.java - tryOpenWithPackage() æ–¹æ³•
// æ”¹åŠ¨ï¼šæ·»åŠ åæ ‡æå–å’ŒURI Schemeæ„å»º

String[] coords = extractCoordinatesFromAmapUrl(amapUrl);
String amapScheme = String.format(
    "amap://navi?start=%s,%s&destination=%s,%s&mode=driving&sourceApplication=net.qsgl365",
    coords[0], coords[1], coords[2], coords[3]
);
```

**æ•ˆæœï¼š**
- âœ“ Amapèƒ½æ­£ç¡®è§£æç›®çš„åœ°åæ ‡
- âœ“ è‡ªåŠ¨å¯¼èˆªä¸å†éœ€è¦æ‰‹åŠ¨è¾“å…¥

### ä¿®æ”¹2ï¼šActivityç”Ÿå‘½å‘¨æœŸç®¡ç†

```java
// ä½ç½®ï¼šMainActivity.java
// æ–°å¢ï¼šonResume() å’Œ onPause() æ–¹æ³•

@Override
protected void onResume() {
    super.onResume();
    if (webView != null) {
        webView.onResume();
        webView.addJavascriptInterface(new JSBridge(), "AndroidBridge");
    }
}

@Override
protected void onPause() {
    if (webView != null) {
        webView.onPause();
    }
    super.onPause();
}
```

**æ•ˆæœï¼š**
- âœ“ WebViewçŠ¶æ€æ­£ç¡®ç®¡ç†
- âœ“ è¿”å›æ—¶JavaScript Bridgeå¯ç”¨
- âœ“ é¡µé¢å†…å®¹æ­£å¸¸æ˜¾ç¤º

---

## âœ… å®Œæ•´æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨ï¼Œå¯åŠ è½½é¡µé¢
- [ ] å¯¼èˆªåŠŸèƒ½å¯ç‚¹å‡»
- [ ] é«˜å¾·åœ°å›¾åº”ç”¨å¯å¯åŠ¨

### é—®é¢˜1ä¿®å¤æµ‹è¯•

- [ ] Amapè‡ªåŠ¨æ˜¾ç¤ºèµ·ç‚¹åæ ‡
- [ ] Amapè‡ªåŠ¨æ˜¾ç¤ºç›®çš„åœ°åæ ‡
- [ ] å¯¼èˆªè·¯çº¿è‡ªåŠ¨è®¡ç®—æ˜¾ç¤º
- [ ] æ— éœ€æ‰‹åŠ¨è¾“å…¥åæ ‡

### é—®é¢˜2ä¿®å¤æµ‹è¯•

- [ ] ä»Amapè¿”å›Appæ­£å¸¸æ˜¾ç¤º
- [ ] é¡µé¢å†…å®¹å®Œæ•´å¯è§
- [ ] å¯æ­£å¸¸æ»šåŠ¨å’Œäº¤äº’
- [ ] å¯¼èˆªèœå•ä»å¯ä½¿ç”¨

### è¾¹ç•Œæƒ…å†µæµ‹è¯•

- [ ] è¿”å›æ—¶å¿«é€Ÿç‚¹å‡»ï¼ˆé˜²æ­¢å¤šæ¬¡åŠ è½½ï¼‰
- [ ] é•¿æ—¶é—´åœ¨Amapæ“ä½œåè¿”å›
- [ ] ç½‘ç»œä¸ç¨³å®šæ—¶çš„è¡¨ç°
- [ ] è®¾å¤‡æ¯å±å†äº®å±çš„è¡¨ç°

### æ—¥å¿—éªŒè¯

- [ ] å¯åœ¨logcatä¸­æŸ¥çœ‹å¯¼èˆªå¤„ç†æ—¥å¿—
- [ ] è¿”å›æ—¶æœ‰onResume()ç›¸å…³æ—¥å¿—
- [ ] æ— å¼‚å¸¸é”™è¯¯è¾“å‡º
- [ ] Bridgeæ³¨å…¥æ—¥å¿—æ­£ç¡®æ˜¾ç¤º

---

## ğŸ“± æµ‹è¯•ç¯å¢ƒ

```
è®¾å¤‡ï¼šVivo V2166BA
ç³»ç»Ÿï¼šAndroid 13
é«˜å¾·åœ°å›¾ç‰ˆæœ¬ï¼šæœ€æ–°ç‰ˆï¼ˆéœ€è¦å·²å®‰è£…ï¼‰
365APPç‰ˆæœ¬ï¼šå·²å®‰è£…æœ€æ–°ç¼–è¯‘ç‰ˆæœ¬
```

---

## ğŸ¯ æµ‹è¯•å®Œæˆæ ‡å‡†

### é—®é¢˜1å®Œæˆæ ‡å‡†
```
âœ“ Amapåº”ç”¨èƒ½å¤Ÿè‡ªåŠ¨è·å–å’Œæ˜¾ç¤ºç›®çš„åœ°åæ ‡
âœ“ ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ä»»ä½•åæ ‡ä¿¡æ¯
âœ“ å¯¼èˆªè·¯çº¿èƒ½å¤Ÿç«‹å³è®¡ç®—å¹¶æ˜¾ç¤º
```

### é—®é¢˜2å®Œæˆæ ‡å‡†
```
âœ“ ä»Amapè¿”å›åAppç•Œé¢æ­£å¸¸æ˜¾ç¤ºï¼ˆéç™½å±ï¼‰
âœ“ WebViewèƒ½æ­£å¸¸æ¸²æŸ“å’Œäº¤äº’
âœ“ ç”¨æˆ·ä¹‹å‰çš„æ“ä½œçŠ¶æ€èƒ½å¤Ÿä¿ç•™
```

---

## ğŸ“ è°ƒè¯•è”ç³»

å¦‚æœæµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**
   ```powershell
   adb -s 192.168.1.75:37547 logcat -d > logcat.txt
   ```

2. **æŸ¥çœ‹é”™è¯¯ä¿¡æ¯**
   ```powershell
   adb -s 192.168.1.75:37547 logcat -d | findstr "Error|Exception|crash"
   ```

3. **é‡æ–°å®‰è£…App**
   ```powershell
   adb -s 192.168.1.75:37547 uninstall net.qsgl365
   adb -s 192.168.1.75:37547 install app/build/outputs/apk/release/app-release.apk
   ```

---

**ä¿®å¤çŠ¶æ€ï¼šâœ… å®Œæˆå¹¶éƒ¨ç½²**

