# 微信支付接口文件搜索结果总结

## 📌 任务完成

根据农行综合收银台API接口说明文档（https://bank.u51.com/ebus-two/docs/#/）关于微信支付的描述，已完成了对以下目录的搜索和分析：

**搜索目录**：`K:\365-android\综合收银台接口包_V4.0软件包`

---

## 🎯 搜索结果概览

### 发现的微信支付相关文件

| 序号 | 文件名 | 位置 | 功能 | 优先级 |
|------|--------|------|------|--------|
| 1 | **MerchantPaymentUnified.aspx** | demo/ | 统一支付接口（微信、支付宝等） | ⭐⭐⭐⭐⭐ |
| 2 | GetWeiXinAuthInfo.aspx | demo/ | 微信人脸认证 | ⭐⭐⭐ |
| 3 | MerchantPayCancel.aspx | demo/ | 支付撤销/退款 | ⭐⭐⭐ |
| 4 | MerchantRealTimeRegister.aspx | demo/ | 实时结算注册 | ⭐⭐ |
| 5 | DownloadStatement.aspx | demo/ | 对账单下载 | ⭐⭐ |
| 6 | Merchant.html | demo/ | 菜单导航页面 | ⭐ |

---

## 📂 完整文件列表

### 微信支付核心文件详情

#### 1️⃣ MerchantPaymentUnified.aspx (最重要)
```
位置：K:\365-android\综合收银台接口包_V4.0软件包\demo\
大小：501 行 C#/HTML 代码
功能：统一支付请求
调用类：com.abc.trustpay.client.ebus.UnifiedPaymentRequest

关键参数：
- PaymentType = "8"        ← 微信支付的关键参数
- PayTypeID               ← 支付类型（公众号/小程序/APP/刷卡）
- AccountNo               ← APPID或授权码
- OpenID                  ← 用户OpenID（公众号/小程序必填）
- OrderAmount             ← 订单金额
- OrderDate/OrderTime     ← 订单日期和时间
```

#### 2️⃣ GetWeiXinAuthInfo.aspx
```
位置：K:\365-android\综合收银台接口包_V4.0软件包\demo\
功能：获取微信人脸认证信息
调用类：com.abc.trustpay.client.ebus.GetWeiXinAuthInfo

关键参数：
- StoreId       ← 门店ID
- StoreName     ← 门店名称
- SubAppId      ← 子商户APPID
- RawData       ← 原始数据

返回值：
- AuthInfo      ← 用于调用微信人脸SDK的认证信息
- ExpiresIn     ← 过期时间
```

#### 3️⃣ MerchantPayCancel.aspx
```
位置：K:\365-android\综合收银台接口包_V4.0软件包\demo\
功能：支付撤销和退款处理
调用类：com.abc.trustpay.client.ebus.MerchantPayCancel

关键参数：
- MerchantFlag = "W"       ← 微信（Z=支付宝）
- OrigOrderNo              ← 原订单号
- CancelAmount             ← 退款金额
```

#### 4️⃣ MerchantRealTimeRegister.aspx
```
位置：K:\365-android\综合收银台接口包_V4.0软件包\demo\
功能：实时结算注册（交易记录注册）

关键参数：
- TrnxCode = "8"           ← 支付方式代码（8=微信，9=支付宝）
- TrnxType                 ← 交易状态（SUCCESS/REFUND等）
- CustomId                 ← 用户标识（对应微信对账单的用户标识）
```

#### 5️⃣ DownloadStatement.aspx
```
位置：K:\365-android\综合收银台接口包_V4.0软件包\demo\
功能：对账单下载

支持的对账单类型：
- "W"         ← 微信对账单
- "WXALIPAY"  ← 微信支付宝对账单
- "Z"         ← 支付宝对账单
```

#### 6️⃣ Merchant.html
```
位置：K:\365-android\综合收银台接口包_V4.0软件包\demo\
功能：商户操作菜单主页
包含链接：GetWeiXinAuthInfo.aspx（获取微信人脸验证）
```

---

## 📊 微信支付参数对应关系

### 农行字段 ← → 微信字段映射

| 农行字段 | 对应微信字段 | 说明 | 备注 |
|---------|------------|------|------|
| `AccountNo` | `sub_appid` | 子商户APPID | 公众号/小程序支付时 |
| `AccountNo` | `auth_code` | 授权码 | 刷卡支付时 |
| `OpenID` | `sub_openid` | 用户唯一标识 | 在子商户appid下 |
| `OrderNo` | `out_trade_no` | 外部订单号 | - |
| `OrderAmount` | `total_fee` | 总金额(分) | 需要转换单位 |
| `OrderDesc` | `body` | 商品描述 | - |
| `TrnxType` | 交易状态 | SUCCESS/REFUND等 | 来自微信对账单 |
| `CustomId` | 用户标识 | 用户唯一标识 | 来自微信对账单 |
| `PaymentType` | - | **"8"=微信支付** | 必须为8 |
| `TrnxCode` | - | **"8"=微信支付** | 必须为8 |

---

## 🔍 搜索方法和结果

### 使用的搜索关键词
```
搜索范围：K:\365-android\综合收银台接口包_V4.0软件包\demo\
搜索模式：grep 搜索含有以下关键词的文件

关键词：
- WeiXin / WeChat
- 微信
- wechat
- 支付
- payment
```

### 搜索命中的文件（共15处匹配）

1. **MerchantPaymentUnified.aspx** (5处提及)
   - 标题：微信支付请求
   - PaymentType = "8" 的说明
   - AccountNo / OpenID / PayTypeID 的微信映射

2. **GetWeiXinAuthInfo.aspx** (2处提及)
   - 获取微信人脸验证
   - 调用微信SDK的接口定义

3. **MerchantPayCancel.aspx** (1处提及)
   - MerchantFlag = "W" 标识微信

4. **MerchantRealTimeRegister.aspx** (3处提及)
   - TrnxCode = "8" 的微信说明
   - TrnxType 对应微信对账单交易状态
   - CustomId 对应微信对账单用户标识

5. **DownloadStatement.aspx** (1处提及)
   - "WXALIPAY" 微信支付宝对账单

6. **Merchant.html** (1处提及)
   - 链接导航到 GetWeiXinAuthInfo.aspx

---

## 📖 生成的参考文档

为了方便你快速查询和集成，已生成以下3份参考文档：

### 1. 📄 **微信支付接口文件清单.md**
**文件位置**：`K:\365-android\微信支付接口文件清单.md`

**内容**：
- 6个核心文件的详细说明
- 完整的参数列表和说明
- 参数映射关系表
- 微信支付集成关键点
- API调用示例
- 支付流程图

---

### 2. 📋 **微信支付快速参考卡.md**
**文件位置**：`K:\365-android\微信支付快速参考卡.md`

**内容**：
- 核心文件速查表
- 支付参数速查表
- 支付流程（一页纸总结）
- 代码片段（最常用）
- 关键字段映射
- 常见问题解答

**适用场景**：在开发过程中快速参考

---

### 3. 📚 **农行微信支付完整接口索引.md**
**文件位置**：`K:\365-android\农行微信支付完整接口索引.md`

**内容**：
- 完整目录结构分析
- 6个文件的详细功能说明
- 核心类库和命名空间
- 完整的支付流程图
- 完整的示例代码
- 集成检查清单

**适用场景**：全面了解和集成微信支付

---

## 🎓 快速开始指南

### 如果你只有5分钟：
👉 阅读：**微信支付快速参考卡.md** 中的代码片段

### 如果你有30分钟：
👉 阅读：**微信支付接口文件清单.md** 的"核心参数"部分

### 如果你要进行完整集成：
👉 阅读：**农行微信支付完整接口索引.md** 的全部内容

---

## 🔗 关键信息速查

### 最重要的文件
```
MerchantPaymentUnified.aspx
↓
支付类型参数：PaymentType = "8"
↓
需要的参数：
- OrderNo       (订单号)
- OrderAmount   (金额)
- PayTypeID     (支付类型：公众号/小程序/APP/刷卡)
- AccountNo     (APPID或授权码)
- OpenID        (用户OpenID，可选)
```

### 最重要的参数
```
PaymentType = "8"      ← 表示微信支付的唯一方法
```

### 支付类型代码
```
8  = 微信支付
9  = 支付宝支付
A  = 农行卡支付
```

---

## ✅ 验证清单

- [x] 找到了6个微信支付相关文件
- [x] 提取了所有关键参数
- [x] 建立了参数映射关系
- [x] 生成了3份参考文档
- [x] 提供了代码示例
- [x] 创建了快速参考卡

---

## 💡 建议

1. **立即查看**：`微信支付快速参考卡.md` 了解基本概念
2. **详细学习**：`农行微信支付完整接口索引.md` 进行深入理解
3. **开发参考**：`微信支付接口文件清单.md` 作为详细手册

---

## 📞 相关资源

**官方文档**：
```
https://bank.u51.com/ebus-two/docs/#/
```

**本地文件位置**：
```
K:\365-android\综合收银台接口包_V4.0软件包\
```

**生成的文档**：
```
K:\365-android\微信支付接口文件清单.md
K:\365-android\微信支付快速参考卡.md
K:\365-android\农行微信支付完整接口索引.md
```

---

**任务完成时间**：2026-01-07  
**搜索范围**：K:\365-android\综合收银台接口包_V4.0软件包  
**找到的文件**：6个微信支付核心文件  
**生成的文档**：3份（清单 + 快速参考 + 完整索引）
