# ğŸš€ å†œè¡Œç»¼åˆæ”¶é“¶å°æ”¯ä»˜ - ç¼–è¯‘å’Œæµ‹è¯•æŒ‡å—

## ğŸ“¦ ç¼–è¯‘å‰æ£€æŸ¥æ¸…å•

### âœ… é…ç½®æ£€æŸ¥

- [x] å•†æˆ·å·å·²é…ç½®ï¼š`103881636900016`
- [x] è¯ä¹¦å¯†ç å·²é…ç½®ï¼š`ay365365`
- [x] å•†æˆ·è¯ä¹¦å·²æ”¾ç½®ï¼š`app/src/main/assets/merchant.pfx` (2562 bytes)
- [x] å†œè¡Œå¹³å°è¯ä¹¦å·²æ”¾ç½®ï¼š`app/src/main/assets/TrustPay.cer` (770 bytes)
- [x] ç¯å¢ƒå·²é…ç½®ä¸ºæµ‹è¯•æ¨¡å¼ï¼š`USE_TEST_ENV = true`
- [x] å†œè¡Œ SDK åº“å·²å°±ä½ï¼š`app/libs/TrustPayClient-V3.3.3.jar`
- [x] ç­¾åé…ç½®å·²è®¾ç½®ï¼šRelease ç­¾åä½¿ç”¨ my-release-key.jks

---

## ğŸ”§ ç¼–è¯‘æ­¥éª¤

### 1. æ¸…ç†é¡¹ç›®ï¼ˆå¯é€‰ï¼‰

```bash
cd K:\365-android
.\gradlew.bat clean
```

### 2. ç¼–è¯‘ Debug ç‰ˆæœ¬ï¼ˆæ¨èå…ˆåšï¼‰

```bash
cd K:\365-android
.\gradlew.bat assembleDebug
```

**é¢„æœŸç»“æœ**ï¼š
- è¾“å‡ºæ–‡ä»¶ï¼š`app\build\outputs\apk\debug\app-debug.apk`
- æ–‡ä»¶å¤§å°ï¼š~20-30 MBï¼ˆå«å†œè¡ŒSDKå’Œä¾èµ–ï¼‰

### 3. ç¼–è¯‘ Release ç‰ˆæœ¬ï¼ˆç”¨äºå®é™…æµ‹è¯•ï¼‰

```bash
cd K:\365-android
.\gradlew.bat assembleRelease
```

**é¢„æœŸç»“æœ**ï¼š
- è¾“å‡ºæ–‡ä»¶ï¼š`app\build\outputs\apk\release\app-release.apk`
- æ–‡ä»¶å¤§å°ï¼š~15-20 MBï¼ˆå·²æ··æ·†å‹ç¼©ï¼‰
- å·²ä½¿ç”¨ my-release-key.jks ç­¾å

---

## ğŸ“± å®‰è£…åˆ°è®¾å¤‡

### 1. å®‰è£… Debug ç‰ˆæœ¬

```bash
adb install -r app\build\outputs\apk\debug\app-debug.apk
```

### 2. å®‰è£… Release ç‰ˆæœ¬ï¼ˆæ¨èï¼‰

```bash
adb install -r app\build\outputs\apk\release\app-release.apk
```

### 3. éªŒè¯å®‰è£…

```bash
adb shell pm list packages | findstr qsgl365
```

æœŸæœ›çœ‹åˆ°ï¼š
```
package:net.qsgl365
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨åº”ç”¨

```bash
adb shell am start -n net.qsgl365/.MainActivity
```

### 2. æ¸…é™¤æ—¥å¿—ç¼“å†²

```bash
adb logcat -c
```

### 3. å¼€å§‹æ—¥å¿—ç›‘æ§

```bash
adb logcat | findstr "AbcPay"
```

### 4. åœ¨åº”ç”¨ä¸­æµ‹è¯•æ”¯ä»˜

#### æ–¹å¼ä¸€ï¼šWebå‰ç«¯è°ƒç”¨

æ‰“å¼€åº”ç”¨çš„ WebViewï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
// APP æ”¯ä»˜
window.createWeChatPay({
    orderNo: 'TEST20260105001',
    orderAmount: '0.01',
    orderDesc: 'å†œè¡Œæ”¯ä»˜æµ‹è¯•'
});
```

#### æ–¹å¼äºŒï¼šé€šè¿‡æµ‹è¯•é¡µé¢

åº”ç”¨é€šå¸¸åŒ…å«å†…ç½®çš„æµ‹è¯•é¡µé¢ï¼Œç›´æ¥ç‚¹å‡»"å‘èµ·æ”¯ä»˜"æŒ‰é’®ã€‚

### 5. è§‚å¯Ÿæ—¥å¿—è¾“å‡º

æœŸæœ›çœ‹åˆ°çš„å…³é”®æ—¥å¿—ï¼š

```
AbcPayConfig: ========== å†œè¡Œæ”¯ä»˜é…ç½®ä¿¡æ¯ ==========
AbcPayConfig: å•†æˆ·å·: 103881636900016
AbcPayConfig: ç¯å¢ƒ: æµ‹è¯•ç¯å¢ƒ
AbcPayConfig: æœåŠ¡å™¨: https://pay.test.abchina.com:443

AbcWeChatPayManager: æ”¯ä»˜å‚æ•°æ„å»ºå®Œæˆ
AbcWeChatPayManager: æ­£åœ¨è¯·æ±‚å†œè¡ŒæœåŠ¡å™¨...
AbcWeChatPayManager: å†œè¡ŒæœåŠ¡å™¨è¿”å›:
AbcWeChatPayManager: è¿”å›ç : 0000 (æˆåŠŸ)
AbcWeChatPayManager: è°ƒç”¨å¾®ä¿¡æ”¯ä»˜...

AbcPayResultActivity: æ”¯ä»˜ç»“æœå›è°ƒ
AbcPayResultActivity: æ”¯ä»˜çŠ¶æ€: SUCCESS
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šè¯ä¹¦åŠ è½½å¤±è´¥

**æ—¥å¿—ä¸­å‡ºç°**ï¼š
```
AbcPayConfig: å¤åˆ¶è¯ä¹¦æ–‡ä»¶å¤±è´¥: FileNotFoundException
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®è®¤è¯ä¹¦æ–‡ä»¶å­˜åœ¨
Get-Item -Path K:\365-android\app\src\main\assets\merchant.pfx
Get-Item -Path K:\365-android\app\src\main\assets\TrustPay.cer

# ç¡®è®¤æ–‡ä»¶å¤§å°æ­£ç¡®
# merchant.pfx åº”è¯¥æ˜¯ 2562 bytes
# TrustPay.cer åº”è¯¥æ˜¯ 770 bytes
```

### é—®é¢˜2ï¼šå•†æˆ·å·ä¸åŒ¹é…

**æ—¥å¿—ä¸­å‡ºç°**ï¼š
```
AbcPayConfig: å•†æˆ·å·: null æˆ– (ç¤ºä¾‹å€¼)
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ AbcPayConfig.java æ˜¯å¦æ­£ç¡®ç¼–è¯‘
grep -n "103881636900016" K:\365-android\app\src\main\java\net\qsgl365\AbcPayConfig.java
```

### é—®é¢˜3ï¼šå†œè¡ŒæœåŠ¡å™¨è¿æ¥å¤±è´¥

**æ—¥å¿—ä¸­å‡ºç°**ï¼š
```
AbcWeChatPayManager: è¯·æ±‚å†œè¡ŒæœåŠ¡å™¨å¤±è´¥: SocketTimeoutException
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤ Android ç‰ˆæœ¬æ”¯æŒ TLS 1.2+ï¼ˆæœ€ä½ SDK 21ï¼Œå·²æ»¡è¶³ï¼‰
3. ç¡®è®¤ AndroidManifest.xml åŒ…å«ç½‘ç»œæƒé™ï¼š
   ```xml
   <uses-permission android:name="android.permission.INTERNET" />
   ```

### é—®é¢˜4ï¼šç¼–è¯‘é”™è¯¯ï¼šæ‰¾ä¸åˆ°å†œè¡ŒSDK

**é”™è¯¯ä¿¡æ¯**ï¼š
```
cannot find symbol
  symbol:   class TrustPayClient
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨ build.gradle ä¸­å–æ¶ˆæ³¨é‡Š SDK ä¾èµ–ï¼š
```gradle
dependencies {
    implementation files('libs/TrustPayClient-V3.3.3.jar')
    implementation files('libs/commons-codec-1.3.jar')
    implementation files('libs/commons-httpclient-3.0.1.jar')
    implementation files('libs/commons-logging.jar')
}
```

---

## ğŸ“Š æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šæˆåŠŸæ”¯ä»˜æµç¨‹

```
åº”ç”¨å¯åŠ¨
  â†“
ç‚¹å‡»"å‘èµ·æ”¯ä»˜"æŒ‰é’®
  â†“
JavaScript è°ƒç”¨ createWeChatPay()
  â†“
AbcWeChatPayManager æ„å»ºè¯·æ±‚å‚æ•°
  â†“
HTTP è¯·æ±‚å†œè¡ŒæœåŠ¡å™¨
  â†“
å†œè¡Œè¿”å›é¢„æ”¯ä»˜äº¤æ˜“å• (TradeNo)
  â†“
è°ƒç”¨å¾®ä¿¡æ”¯ä»˜ SDK
  â†“
ç”¨æˆ·ç¡®è®¤æ”¯ä»˜
  â†“
å¾®ä¿¡è¿”å›æ”¯ä»˜ç»“æœ
  â†“
åº”ç”¨æ¥æ”¶æ”¯ä»˜å›è°ƒ
  â†“
æ˜¾ç¤ºæ”¯ä»˜ç»“æœ
```

### åœºæ™¯2ï¼šæ”¯ä»˜å¤±è´¥ï¼ˆæµ‹è¯•ç½‘ç»œé”™è¯¯ï¼‰

```
æ–­å¼€ç½‘ç»œ
  â†“
ç‚¹å‡»"å‘èµ·æ”¯ä»˜"æŒ‰é’®
  â†“
åº”ç”¨æ˜¾ç¤ºç½‘ç»œé”™è¯¯
  â†“
æ¢å¤ç½‘ç»œåé‡è¯•æ”¯ä»˜
```

### åœºæ™¯3ï¼šæ”¯ä»˜è¶…æ—¶ï¼ˆæµ‹è¯•è¶…æ—¶å¤„ç†ï¼‰

```
å†œè¡ŒæœåŠ¡å™¨å“åº”ç¼“æ…¢
  â†“
åº”ç”¨åœ¨30ç§’åè¶…æ—¶
  â†“
æ˜¾ç¤ºè¶…æ—¶æç¤º
  â†“
ç”¨æˆ·ç‚¹å‡»é‡è¯•
```

---

## ğŸ¯ éªŒè¯æ¸…å•

ç¼–è¯‘å¹¶å®‰è£…åï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] åº”ç”¨å®‰è£…æˆåŠŸï¼Œä¸å´©æºƒ
- [ ] åº”ç”¨å¯åŠ¨åèƒ½çœ‹åˆ°æ”¯ä»˜ç›¸å…³çš„ UI
- [ ] ç‚¹å‡»æ”¯ä»˜æŒ‰é’®åæœ‰å“åº”
- [ ] æ—¥å¿—ä¸­çœ‹åˆ°"å†œè¡Œæ”¯ä»˜é…ç½®ä¿¡æ¯"è¾“å‡º
- [ ] æ—¥å¿—ä¸­çœ‹åˆ°æ­£ç¡®çš„å•†æˆ·å· `103881636900016`
- [ ] æ—¥å¿—ä¸­æ˜¾ç¤ºæµ‹è¯•ç¯å¢ƒ URL
- [ ] å†œè¡ŒæœåŠ¡å™¨èƒ½æ­£å¸¸è¿æ¥
- [ ] èƒ½çœ‹åˆ°å†œè¡Œè¿”å›çš„é¢„æ”¯ä»˜äº¤æ˜“å•ä¿¡æ¯
- [ ] èƒ½æ­£å¸¸è°ƒèµ·å¾®ä¿¡æ”¯ä»˜ç•Œé¢
- [ ] æ”¯ä»˜å®Œæˆåèƒ½çœ‹åˆ°å›è°ƒä¿¡æ¯

---

## ğŸ“ æµ‹è¯•æ•°æ®

### æµ‹è¯•è´¦æˆ·ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| **å•†æˆ·å·** | 103881636900016 |
| **è¯ä¹¦å¯†ç ** | ay365365 |
| **ç¯å¢ƒ** | æµ‹è¯•ç¯å¢ƒ (pay.test.abchina.com) |
| **æ”¯ä»˜ç±»å‹** | å¾®ä¿¡æ”¯ä»˜ï¼ˆPaymentType=8ï¼‰ |

### æµ‹è¯•é‡‘é¢

- **æ ‡å‡†æµ‹è¯•é‡‘é¢**ï¼š0.01 å…ƒï¼ˆ1 åˆ†ï¼‰
- **æˆåŠŸé‡‘é¢**ï¼š0.01 - 999999.99 å…ƒï¼ˆæ ¹æ®å†œè¡Œè§„åˆ™ï¼‰
- **æµ‹è¯•æ ¼å¼**ï¼šç²¾ç¡®åˆ°åˆ†ï¼Œå¦‚ "1.23"ã€"0.01"

### æµ‹è¯•è®¢å•å·è§„èŒƒ

```
TEST + æ—¥æœŸ(YYYYMMDD) + æ—¶é—´(HHMMSS) + åºåˆ—å·
ç¤ºä¾‹ï¼šTEST202601051430121
```

---

## ğŸ” å®‰å…¨è€ƒè™‘

### ç”Ÿäº§ç¯å¢ƒè¿ç§»

å½“å‡†å¤‡ä¸Šçº¿æ—¶ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ›´æ”¹ï¼š

#### 1. åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒè¯ä¹¦

```bash
# å¤åˆ¶ç”Ÿäº§ç¯å¢ƒè¯ä¹¦
Copy-Item `
  -Path "K:\365-android\ç»¼åˆæ”¶é“¶å°æ¥å£åŒ…_V3.3.3è½¯ä»¶åŒ…\cert\prod\TrustPay.cer" `
  -Destination "K:\365-android\app\src\main\assets\TrustPay.cer" `
  -Force
```

#### 2. æ›´æ–°é…ç½®ç±»

ç¼–è¾‘ `AbcPayConfig.java`ï¼š

```java
// æ”¹ä¸ºç”Ÿäº§ç¯å¢ƒ
public static boolean USE_TEST_ENV = false;

// æ›´æ–°ä¸ºç”Ÿäº§å•†æˆ·å·ï¼ˆä»å†œè¡Œè·å–ï¼‰
public static final String MERCHANT_ID = "ä½ çš„ç”Ÿäº§å•†æˆ·å·";

// æ›´æ–°ç”Ÿäº§å¯†ç 
public static final String MERCHANT_CERT_PASSWORD = "ä½ çš„ç”Ÿäº§è¯ä¹¦å¯†ç ";
```

#### 3. é‡æ–°ç¼–è¯‘ç­¾å

```bash
.\gradlew.bat clean assembleRelease
```

#### 4. æµ‹è¯•å‰åç¡®è®¤

- [ ] å·²æµ‹è¯•æ”¯ä»˜æµç¨‹ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰
- [ ] å·²åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ
- [ ] å·²æ›´æ–°å•†æˆ·å·ä¸ºç”Ÿäº§å·
- [ ] å·²éªŒè¯è¯ä¹¦æ–‡ä»¶æ­£ç¡®
- [ ] å·²è”ç³»å†œè¡Œç¡®è®¤å•†æˆ·æ¿€æ´»
- [ ] å·²å®Œæˆ UAT æµ‹è¯•
- [ ] å·²è·å¾—å†œè¡Œæ‰¹å‡†

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è·å–å†œè¡Œçš„å®æ—¶æµ‹è¯•é“¾æ¥ï¼Ÿ

A: è®¿é—® https://pay.test.abchina.com/easyebus/ æˆ–è”ç³»å†œè¡ŒæŠ€æœ¯æ”¯æŒã€‚

### Q: è¯ä¹¦å¯†ç é”™è¯¯ä¼šæ€æ ·ï¼Ÿ

A: å†œè¡ŒæœåŠ¡å™¨ä¼šè¿”å›å¦‚ä¸‹é”™è¯¯ï¼š
```
{"ReturnCode":"0001","ErrorMessage":"è¯ä¹¦éªŒè¯å¤±è´¥"}
```
æ­¤æ—¶éœ€è¦æ£€æŸ¥ `AbcPayConfig.java` ä¸­çš„ `MERCHANT_CERT_PASSWORD`ã€‚

### Q: å¦‚ä½•çŸ¥é“å†œè¡ŒæœåŠ¡å™¨å·²æˆåŠŸå¤„ç†è¯·æ±‚ï¼Ÿ

A: æŸ¥çœ‹æ—¥å¿—ä¸­çš„è¿”å›ç ï¼š
```
å†œè¡Œè¿”å›ç : 0000  // æˆåŠŸ
å†œè¡Œè¿”å›ç : 0001  // è¯ä¹¦é”™è¯¯
å†œè¡Œè¿”å›ç : 0002  // å•†æˆ·å·é”™è¯¯
```

### Q: æµ‹è¯•è¿‡ç¨‹ä¸­æ˜¯å¦ä¼šå®é™…æ‰£æ¬¾ï¼Ÿ

A: åœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œ**ä¸ä¼šå®é™…æ‰£æ¬¾**ï¼Œæ‰€æœ‰äº¤æ˜“éƒ½æ˜¯æ¨¡æ‹Ÿçš„ã€‚

---

## âœ¨ å®Œæˆæ ‡å¿—

âœ… æ‰€æœ‰é…ç½®å·²å®Œæˆ
âœ… è¯ä¹¦æ–‡ä»¶å·²å°±ä½
âœ… åº”ç”¨å·²å‡†å¤‡ç¼–è¯‘
âœ… æµ‹è¯•æŒ‡å—å·²æä¾›

**ç°åœ¨å¯ä»¥å¼€å§‹ç¼–è¯‘å’Œæµ‹è¯•ï¼**

---

**æœ€åæ›´æ–°æ—¶é—´**ï¼š2026å¹´1æœˆ5æ—¥
**é…ç½®å®Œæˆåº¦**ï¼š100%
